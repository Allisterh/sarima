<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Applies an extended ARMA filter to a time series — xarmaFilter • sarima</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Applies an extended ARMA filter to a time series — xarmaFilter" />
<meta property="og:description" content="Filter time series with an extended arma filter.
  If whiten is FALSE (default) the function applies
  the given ARMA filter to eps (eps is often
  white noise).  If whiten is TRUE the function applies
  the &amp;#8220;inverse filter&amp;#8221; to \(x\), effectively computing
  residuals." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sarima</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.8.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/GeoBosh/sarima/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Applies an extended ARMA filter to a time series</h1>
    
    <div class="hidden name"><code>xarmaFilter.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Filter time series with an extended arma filter.
  If <code>whiten</code> is <code>FALSE</code> (default) the function applies
  the given ARMA filter to <code>eps</code> (<code>eps</code> is often
  white noise).  If <code>whiten</code> is <code>TRUE</code> the function applies
  the &#8220;inverse filter&#8221; to \(x\), effectively computing
  residuals.</p>
    </div>

    <pre class="usage"><span class='fu'>xarmaFilter</span>(<span class='no'>model</span>, <span class='kw'>x</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>eps</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>from</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>whiten</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
            <span class='kw'>xcenter</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>xintercept</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>the time series to be filtered, a vector.</p></td>
    </tr>
    <tr>
      <th>eps</th>
      <td><p>residuals, a vector or NULL.</p></td>
    </tr>
    <tr>
      <th>model</th>
      <td><p>the model parameters, a list with components <code>"ar"</code>,
    <code>"ma"</code>, <code>"center"</code> and <code>"intercept"</code>, see Details.</p></td>
    </tr>
    <tr>
      <th>from</th>
      <td><p>the index from which to start filtering.</p></td>
    </tr>
    <tr>
      <th>whiten</th>
      <td><p>if TRUE use <code>x</code> as input and apply the inverse filter to
    produce <code>eps</code> ("whiten" <code>x</code>), if FALSE use <code>eps</code> as
    input and generate <code>x</code> ("colour" <code>eps</code>).</p></td>
    </tr>
    <tr>
      <th>xcenter</th>
      <td><p>a vector of means of the same length as the time series, see Details.</p></td>
    </tr>
    <tr>
      <th>xintercept</th>
      <td><p>a vector of intercepts having the length of the series, see Details.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    

<p>The model is specified by argument <code>model</code>, which is a list with
  the following components:</p><dl'>

    <dt><code>ar</code></dt><dd><p>the autoregression parameters,</p></dd>
    <dt><code>ma</code></dt><dd><p>the moving average parameters,</p></dd>
    <dt><code>center</code></dt><dd><p>center by this value,</p></dd>
    <dt><code>intercept</code></dt><dd><p>intercept.</p></dd>

  
</dl>

<p><code>model$center</code> and <code>model$intercept</code> are scalars and usually
  at most one of them is nonzero. They can be considered part of the
  model specification. In contrast, arguments <code>xcenter</code> and
  <code>xintercept</code> are vectors of the same length as <code>x</code>. They can
  represent contributions from covariate variables. Usually at most one
  of <code>xcenter</code> and <code>xintercept</code> is used.</p>
<p>The description below uses \(\mu_t\) and \(c_t\) for
  the contributions by <code>model$center</code> plus <code>xcenter</code> and
  <code>model$intercept</code> plus <code>xintercept</code>, respectively.
  The time series \(\{x_t\}\) and \(\{\varepsilon_t\}\) are
  represented by <code>x</code> and <code>eps</code> in the <span style="R">R</span> code.
  Let
      $$y_t = x_t - \mu_t$$
  be the centered series.  where the centering term \(\mu_t\)
  is essentially the sum of <code>center</code> and <code>xcenter</code> and is not
  necessarilly the mean.  The equation relating the centered series,
  \(y_t=x_t - \mu_t\), and <code>eps</code> is the
  following:
    $$ y_t
    =   c_t
      + \sum_{i=1}^{p} \phi(i)y            _{t-i}
      + \sum_{i=1}^{q} \theta(i)\varepsilon_{t-i}
      + \varepsilon_t
    $$
  where \(c_t\) is the intercept (basically the sum of
  <code>intercept</code> with <code>xintercept</code>).</p>
<p>If <code>whiten = FALSE</code>, \(y_t\) is computed for
  <code>t=from,...,n</code> using the above formula, i.e. the filter is
  applied to get <code>y</code> from <code>eps</code> (and some initial values). If
  <code>eps</code> is white noise, it can be said that <code>y</code> is obtained by
  ``colouring'' the white noise <code>eps</code>. This can be used, for
  example, to simulate ARIMA time series.  Finally, the centering term
  is added back, \(x_t=y_t+\mu_t\) for <code>t=from,...,n</code>, and the
  modified <code>x</code> is returned.  The first <code>from - 1</code> elements of
  <code>x</code> are left unchanged.</p>

<p>The inverse filter is obtained by rewriting the above equation as an equation
  expressing \(\varepsilon_t\) in terms of the remaining quantities:
  $$ \varepsilon_t
    = - c_t
      - \sum_{i=1}^{q} \theta(i)\varepsilon_{t-i}
      - \sum_{i=1}^{p} \phi  (i)y          _{t-i}
      + y_t
    $$</p>
<p>If <code>whiten = TRUE</code>, <code>xarmaFilter</code> uses this formula for
  <code>t=from,...,n</code> to compute <code>eps</code> from <code>y</code> (and some
  initial values). If <code>eps</code> is white noise, then it can be said
  that the time series <code>y</code> has been whitened.</p>
<p>In both cases the first few values in <code>x</code> and/or
  <code>eps</code> are used as initial values.</p>

<p>The centering is formed from <code>model$center</code> and argument
  <code>xcenter</code>.  If <code>model$center</code> is supplied it is recycled
  to the length of the series, <code>x</code>, and subtracted from
  <code>x</code>. If argument <code>xcenter</code> is supplied, it is subtracted
  from <code>x</code>. If both <code>model$center</code> and <code>xcenter</code> are
  supplied their sum is subtracted from <code>x</code>.</p>
<p><code>xarmaFilter</code> can be used to simulate ARMA series with the
  default value of <code>whiten = FALSE</code>. In this case <code>eps</code> is the
  input series and <code>y</code> the output:
  Then <code>model$center</code> and/or <code>xcenter</code> are added to <code>y</code>
  to form the output vector <code>x</code>.</p>
<p>Residuals corresponding to a series <code>x</code> can be obtained by
  setting <code>whiten = TRUE</code>. In this case <code>x</code> is the input series.
  The elements of the output vector <code>eps</code> are calculated by the
  formula for \(\varepsilon_{t}\) given above.
  There is no need in this case to restore <code>x</code> since <code>eps</code> is
  returned.</p>
<p>In both cases any necessary initial values are assumed to be already
  in the vectors and provide the first <code>from - 1</code> values in the
  returned vectors.  Argument <code>from</code> should not be smaller than the
  default value <code>max(p,q)+1</code>.</p>
<p><code>xarmaFilter</code> calls the lower level function <code>coreXarmaFilter</code>
  to do the computation.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>the result of applying the filter or its inverse, as descibed in Details:
    if <code>whiten = FALSE</code>, the modified <code>x</code>;
    if <code>whiten = TRUE</code>, the modified <code>eps</code>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## define a seasonal ARIMA model</span>
<span class='no'>m1</span> <span class='kw'>&lt;-</span> <span class='fu'>new</span>(<span class='st'>"SarimaModel"</span>, <span class='kw'>iorder</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>siorder</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>ma</span> <span class='kw'>=</span> -<span class='fl'>0.3</span>, <span class='kw'>sma</span> <span class='kw'>=</span> -<span class='fl'>0.1</span>, <span class='kw'>nseasons</span> <span class='kw'>=</span> <span class='fl'>12</span>)

<span class='no'>model0</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='modelCoef.html'>modelCoef</a></span>(<span class='no'>m1</span>, <span class='st'>"ArmaModel"</span>)
<span class='no'>model1</span> <span class='kw'>&lt;-</span> <span class='fu'>as</span>(<span class='no'>model0</span>, <span class='st'>"list"</span>)

<span class='no'>ap.1</span> <span class='kw'>&lt;-</span> <span class='fu'>xarmaFilter</span>(<span class='no'>model1</span>, <span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>AirPassengers</span>, <span class='kw'>whiten</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='no'>ap.2</span> <span class='kw'>&lt;-</span> <span class='fu'>xarmaFilter</span>(<span class='no'>model1</span>, <span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>AirPassengers</span>, <span class='kw'>eps</span> <span class='kw'>=</span> <span class='no'>ap.1</span>, <span class='kw'>whiten</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='no'>ap</span> <span class='kw'>&lt;-</span> <span class='no'>AirPassengers</span>
<span class='no'>ap</span>[-(<span class='fl'>1</span>:<span class='fl'>13</span>)] <span class='kw'>&lt;-</span> <span class='fl'>0</span> <span class='co'># check that the filter doesn't use x, except for initial values.</span>
<span class='no'>ap.2a</span> <span class='kw'>&lt;-</span> <span class='fu'>xarmaFilter</span>(<span class='no'>model1</span>, <span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>ap</span>, <span class='kw'>eps</span> <span class='kw'>=</span> <span class='no'>ap.1</span>, <span class='kw'>whiten</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='no'>ap.2a</span> - <span class='no'>ap.2</span> <span class='co'>## indeed = 0</span></div><div class='output co'>#&gt;      Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
#&gt; 1949   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1950   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1951   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1952   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1953   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1954   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1955   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1956   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1957   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1958   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1959   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1960   0   0   0   0   0   0   0   0   0   0   0   0</div><div class='input'><span class='co'>##ap.3 &lt;- xarmaFilter(model1, x = list(init = AirPassengers[1:13]), eps = ap.1, whiten = TRUE)</span>

<span class='co'>## now set some non-zero initial values for eps</span>
<span class='no'>eps1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>numeric</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='no'>AirPassengers</span>))
<span class='no'>eps1</span>[<span class='fl'>1</span>:<span class='fl'>13</span>] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='fl'>13</span>)
<span class='no'>ap.A</span> <span class='kw'>&lt;-</span> <span class='fu'>xarmaFilter</span>(<span class='no'>model1</span>, <span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>AirPassengers</span>, <span class='kw'>eps</span> <span class='kw'>=</span> <span class='no'>eps1</span>, <span class='kw'>whiten</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
<span class='no'>ap.Ainv</span> <span class='kw'>&lt;-</span> <span class='fu'>xarmaFilter</span>(<span class='no'>model1</span>, <span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>ap</span>, <span class='kw'>eps</span> <span class='kw'>=</span> <span class='no'>ap.A</span>, <span class='kw'>whiten</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='no'>AirPassengers</span> - <span class='no'>ap.Ainv</span> <span class='co'># = 0</span></div><div class='output co'>#&gt;      Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
#&gt; 1949   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1950   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1951   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1952   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1953   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1954   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1955   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1956   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1957   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1958   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1959   0   0   0   0   0   0   0   0   0   0   0   0
#&gt; 1960   0   0   0   0   0   0   0   0   0   0   0   0</div><div class='input'>
<span class='co'>## compare with sarima.f (an old function)</span>
<span class='co'>## compute predictions starting at from = 14</span>
<span class='no'>pred1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='sarima.f.html'>sarima.f</a></span>(<span class='kw'>past</span> <span class='kw'>=</span> <span class='no'>AirPassengers</span>[<span class='fl'>1</span>:<span class='fl'>13</span>], <span class='kw'>n</span> <span class='kw'>=</span> <span class='fl'>131</span>, <span class='kw'>ar</span> <span class='kw'>=</span> <span class='no'>model1</span>$<span class='no'>ar</span>, <span class='kw'>ma</span> <span class='kw'>=</span> <span class='no'>model1</span>$<span class='no'>ma</span>)
<span class='no'>pred2</span> <span class='kw'>&lt;-</span> <span class='fu'>xarmaFilter</span>(<span class='no'>model1</span>, <span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>ap</span>, <span class='kw'>whiten</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)
<span class='no'>pred2</span> <span class='kw'>&lt;-</span> <span class='no'>pred2</span>[-(<span class='fl'>1</span>:<span class='fl'>13</span>)]
<span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span>(<span class='no'>pred1</span> <span class='kw'>==</span> <span class='no'>pred2</span>) <span class='co'>##TRUE</span></div><div class='output co'>#&gt; [1] TRUE</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Georgi N. Boshnakov, Jamie Halliday.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


